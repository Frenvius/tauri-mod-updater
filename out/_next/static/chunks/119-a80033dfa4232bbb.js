(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[119],{7119:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return P}});var r=e(7568),a=e(828),i=e(655),s=e(5893),c=e(7294),o=e(9072),u=e(6771),l=e.n(u),d=e(1109),h=e.n(d),f=e(9386),p=function(){var n=c.useRef(null),t=c.useContext(f.O).logs;return c.useEffect(function(){var t;null===(t=n.current)||void 0===t||t.scrollIntoView({behavior:"smooth"})},[t]),(0,s.jsx)("div",{className:h().container,children:(0,s.jsxs)("div",{children:[t.map(function(n,t){return(0,s.jsx)("p",{children:n},t)}),(0,s.jsx)("div",{ref:n})]})})},_=e(594),m=e(1606),x=e(5721),g=e(5605),v=e.n(g);function y(n){var t=n.anchorEl,e=n.setAnchorEl,r=n.openFolder,a=n.uninstall,i=n.startGame,c=Boolean(t),o=function(){e(null)},u=function(){r(),o()},l=function(){a(),o()},d=function(){i(),o()};return(0,s.jsxs)(m.Z,{anchorEl:t,open:c,onClose:o,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:[(0,s.jsx)(x.Z,{className:v().menuItem,onClick:l,children:"Force Update"}),(0,s.jsx)(x.Z,{className:v().menuItem,onClick:u,children:"Valheim Folder"}),(0,s.jsx)(x.Z,{className:v().menuItem,onClick:d,children:"Start Game"})]})}var w=e(8340),Z=e.n(w),b=function(n){var t=n.openFolder,e=n.uninstall,r=n.startGame,i=(0,a.Z)(c.useState(null),2),o=i[0],u=i[1],l=window.__TAURI__.window.appWindow,d=function(n){u(n.currentTarget)};return(0,s.jsxs)("div",{className:Z().container,children:[(0,s.jsx)("button",{className:"".concat(Z().btn," ").concat(Z().options),onClick:d,children:"Options"}),(0,s.jsx)(y,{anchorEl:o,setAnchorEl:u,openFolder:t,uninstall:e,startGame:r}),(0,s.jsx)("div",{"data-tauri-drag-region":!0,className:Z().titleBar}),(0,s.jsx)("button",{className:"".concat(Z().btn," ").concat(Z().closeButton),onClick:function(){return l.close()},children:(0,s.jsx)(_.Z,{sx:{fontSize:15,color:"#d2d2d2"}})})]})},j=e(4924),k=e(6042),I=e(1953),C=e(7074),N=e(3149),U=e(399),S=(0,C.ZP)(N.Z)(function(){var n;return n={height:30,border:"1px solid #646464"},(0,j.Z)(n,"&.".concat(U.Z.colorPrimary),{backgroundColor:"#262626"}),(0,j.Z)(n,"& .".concat(U.Z.bar),{border:"1px solid #646464",backgroundColor:"#308fe8"}),n}),E=function(n){return(0,s.jsx)(I.Z,{sx:{width:"100%"},children:(0,s.jsx)(S,(0,k.Z)({},n))})},P=function(){var n,t,e,u,d,h,_,m,x,g=c.useContext(f.O).setLog,v=(0,a.Z)(c.useState("Play"),2),y=v[0],w=v[1],Z=(0,a.Z)(c.useState(0),2),j=Z[0],k=Z[1],I=(0,a.Z)(c.useState(!1),2),C=I[0],N=I[1],U=(0,a.Z)(c.useState(!1),2),S=U[0],P=U[1],T=(0,a.Z)(c.useState(!1),2),R=T[0],B=T[1],F=(0,a.Z)(c.useState("determinate"),2),O=F[0],A=F[1],V=(0,a.Z)(c.useState("Checking for updates..."),2),D=V[0],z=V[1],G=window.__TAURI__.invoke,W=window.__TAURI__.shell.Command,J=window.__TAURI__.window.appWindow,L=null==window?void 0:window.__TAURI__.fs,Y=L.exists,$=L.readTextFile,K=L.removeDir,M=L.removeFile,Q=L.writeTextFile,X=(n=(0,r.Z)(function(){var n;return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,G("sys_user_name")];case 1:return n=t.sent(),[2,"C:\\Users\\".concat(n,"\\mod_updater_data.txt")];case 2:return[2]}})}),function(){return n.apply(this,arguments)}),q=(t=(0,r.Z)(function(){var n;return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,X()];case 1:return[4,Y(n=t.sent())];case 2:if(!t.sent())return[3,4];return[4,$(n)];case 3:case 5:return[2,t.sent()];case 4:return[4,Q(n,"{}")];case 6:return[2]}})}),function(){return t.apply(this,arguments)}),H=(e=(0,r.Z)(function(n){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,q()];case 1:return[2,JSON.parse(t.sent())[n]]}})}),function(n){return e.apply(this,arguments)}),nn=(u=(0,r.Z)(function(n,t){var e,r;return(0,i.__generator)(this,function(a){switch(a.label){case 0:return[4,X()];case 1:return e=a.sent(),[4,q()];case 2:return(r=JSON.parse(a.sent()))[n]=t,[4,Q(e,JSON.stringify(r))];case 3:return a.sent(),[2]}})}),function(n,t){return u.apply(this,arguments)}),nt=function(){A("indeterminate"),nn("update",!1).then((0,r.Z)(function(){return(0,i.__generator)(this,function(n){switch(n.label){case 0:return[4,nn("installed",!0)];case 1:return n.sent(),w("Play"),N(!1),A("determinate"),k(100),z("Done!"),[2]}})}))};H("installed").then(function(n){P(n)}),H("update").then(function(n){B(n)}),c.useEffect(function(){var n;N(!0),J.listen("git_clone_progress",function(n){return ni(n.payload)}).then(function(n){return n}),J.listen("git_pull_progress",function(n){return ni(n.payload)}).then(function(n){return n}),H("valheim-path").then((n=(0,r.Z)(function(n){return(0,i.__generator)(this,function(t){return n?Y("".concat(n,"\\updater")).then(function(n){n?(nl(),z("Ready to play"),g("-> Ready to play!"),N(!1),w("Play")):(g("-> You need to install the mods first"),nn("installed",!1),nn("update",!1),N(!1),w("Install"))}):ne(),[2]})}),function(t){return n.apply(this,arguments)}))},[]);var ne=function(){var n=setInterval(function(){S?(g("-> Ready to play!"),N(!1)):new W("wmic",["process","where","name='Valheim.exe'","get","ExecutablePath"],{encoding:"utf8"}).execute().then(function(t){var e=t.stdout.replace("ExecutablePath","").trim(),r=e.replace("\\valheim.exe","");e.match(/^(?!.*[\\\/]\s+)(?!(?:.*\s|.*\.|\W+)$)(?:[a-zA-Z]:)?(?:(?:[^<>:"\|\?\*\n])+(?:\/\/|\/|\\\\|\\)?)+$/gm)?nn("valheim-path",r).then(function(){nn("installed",!0).then(function(){new W("taskkill",["/f","/im","Valheim.exe"],{encoding:"utf8"}).execute().then(function(t){g("-> Valheim is already running!"),g("-> Valheim path set!"),clearInterval(n),ns()})})}):(g("-> Please launch Valheim to begin install!"),clearInterval(n),ne())})},2e3)},nr=(d=(0,r.Z)(function(){var n;return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,H("valheim-path")];case 1:return n=t.sent(),[4,K("".concat(n,"\\BepInEx\\plugins"),{recursive:!0})];case 2:return[2,t.sent()]}})}),function(){return d.apply(this,arguments)}),na=(h=(0,r.Z)(function(){var n;return(0,i.__generator)(this,function(t){switch(t.label){case 0:return g("-> Unpacking mods..."),z("Unpacking mods..."),[4,H("valheim-path")];case 1:return n=t.sent(),[2,new W("robocopy",["".concat(n,"\\updater"),"".concat(n),"/E","/XD",".git"],{encoding:"utf8"}).execute()]}})}),function(){return h.apply(this,arguments)}),ni=function(n){n<100&&(k(parseInt(n)),z("Downloading ".concat(n,"%")))},ns=function(){g("-> Downloading mods..."),N(!0),w("Installing"),H("valheim-path").then(function(n){G("git_clone",{url:"https://github.com/Frenvius/disneyland-mods.git",path:"".concat(n,"\\updater"),window:J}).then(function(n){"done"===n&&nn("installed",!0).then(function(){na().then(function(n){n.stderr||nt()})})}).catch(function(n){(n.includes("already exists")||n.includes("exists and is not an empty"))&&(console.log("already exists"),no())})})},nc=function(){H("valheim-path").then(function(n){new W("explorer",["".concat(n)]).execute()})},no=function(){g("-> Updating mods..."),w("Updating"),N(!0),H("valheim-path").then(function(n){G("git_pull",{path:"".concat(n,"\\updater"),window:J}).then(function(n){"done"===n&&nn("installed",!0).then(function(){nr().then(function(){na().then(function(n){n.stderr||nt()})})})}).catch(function(n){(n.includes("already exists")||n.includes("exists and is not an empty"))&&(console.log("already exists"),no())})})},nu=(_=(0,r.Z)(function(){var n;return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,H("valheim-path")];case 1:return n=t.sent(),[4,G("get_current_hash",{path:"".concat(n,"\\updater")})];case 2:return[2,t.sent()]}})}),function(){return _.apply(this,arguments)}),nl=function(){nd().then(function(n){n?g("-> Running latest mods"):(g("-> New updates found!"),w("Update"),nn("update",!0).then(function(){B(!0)}))})},nd=(m=(0,r.Z)(function(){var n,t;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,H("valheim-path")];case 1:return n=e.sent(),[4,G("get_latest_hash",{path:"".concat(n,"\\updater")})];case 2:return t=e.sent(),[4,nu()];case 3:return[2,t===e.sent()]}})}),function(){return m.apply(this,arguments)}),nh=function(){G("run_game_windows",{exec:"/C start steam://rungameid/892970"}).then(function(){g("-> Starting Valheim...")})},nf=(x=(0,r.Z)(function(n,t){var e,r;return(0,i.__generator)(this,function(a){switch(a.label){case 0:return[4,Y(n)];case 1:if(e=a.sent(),r=n.split("\\").pop(),!e)return[3,6];if("file"!==t)return[3,3];return[4,M(n)];case 2:return a.sent(),g("-> Removed file ".concat(r)),[3,5];case 3:return[4,K(n,{recursive:!0})];case 4:a.sent(),g("-> Removed folder ".concat(r)),a.label=5;case 5:return[3,7];case 6:g("-> ".concat(r," does not exist")),a.label=7;case 7:return[2]}})}),function(n,t){return x.apply(this,arguments)}),np=function(){var n;g("-> Removing old files"),N(!0),z("Uninstalling"),H("valheim-path").then((n=(0,r.Z)(function(n){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,nf("".concat(n,"\\updater"),"dir")];case 1:return t.sent(),[4,nf("".concat(n,"\\BepInEx"),"dir")];case 2:return t.sent(),[4,nf("".concat(n,"\\doorstop_libs"),"dir")];case 3:case 5:return t.sent(),[4,nf("".concat(n,"\\doorstop_config.ini"),"file")];case 4:return t.sent(),[4,nf("".concat(n,"\\winhttp.dll"),"file")];case 6:return t.sent(),[2]}})}),function(t){return n.apply(this,arguments)})),nn("installed",!1).then(function(){k(0),z("Uninstalled!"),g("-> Old files removed!"),N(!1),w("Install")})},n_=function(){R&&no(),S?nd().then(function(n){n?nh():nl()}):ns()};return(0,s.jsxs)("div",{children:[(0,s.jsx)(b,{openFolder:nc,uninstall:np,startGame:nh}),(0,s.jsxs)("div",{className:l().container,children:[(0,s.jsx)(p,{}),(0,s.jsxs)(o.ZP,{container:!0,spacing:.5,children:[(0,s.jsxs)(o.ZP,{className:l().statusText,item:!0,xs:12,children:["Status: ",D]}),(0,s.jsx)(o.ZP,{item:!0,xs:8.5,children:(0,s.jsx)(E,{variant:O,value:j})}),(0,s.jsx)(o.ZP,{item:!0,xs:3.5,children:(0,s.jsx)("button",{className:l().playButton,onClick:n_,disabled:C,children:y})})]})]})]})}},1109:function(n){n.exports={container:"styles_container__zpvUC"}},5605:function(n){n.exports={menuItem:"styles_menuItem__TtfiA"}},8340:function(n){n.exports={container:"styles_container__mYt3P",btn:"styles_btn__t87iU",options:"styles_options__ZLtFh",titleBar:"styles_titleBar__yPO6y",closeButton:"styles_closeButton__WtTQk"}},6771:function(n){n.exports={container:"style_container__kT6sC",statusText:"style_statusText__i7DpU",playButton:"style_playButton__9Njh0",notification:"style_notification__aK_iL",hidden:"style_hidden__3dMN4"}}}]);